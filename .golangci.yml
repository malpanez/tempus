# golangci-lint configuration for Tempus
# Documentation: https://golangci-lint.run/usage/configuration/

run:
  timeout: 5m
  tests: true
  build-tags: []

linters:
  enable:
    # Bugs & Correctness
    - errcheck       # Check for unchecked errors
    - govet          # Vet examines Go source code
    - staticcheck    # Go static analysis
    - gosimple       # Simplify code
    - unused         # Check for unused code
    - ineffassign    # Detect ineffectual assignments
    - typecheck      # Type checking

    # Style & Formatting
    - gofmt          # Check formatting
    - goimports      # Check imports
    - whitespace     # Detect unnecessary whitespace
    # misspell disabled - codebase uses American English (normalized/recognized)

    # Complexity & Maintainability
    - gocyclo        # Check cyclomatic complexity
    - gocognit       # Check cognitive complexity
    - funlen         # Check function length
    - lll            # Check long lines

    # Security
    - gosec          # Security issues
    - exportloopref  # Check for exported loop variable references

    # Code Quality
    - unconvert      # Remove unnecessary type conversions
    - unparam        # Find unused function parameters
    - goconst        # Find repeated strings that could be constants
    - godot          # Check comments end with period

linters-settings:
  errcheck:
    check-type-assertions: true
    check-blank: false

  govet:
    enable-all: true
    disable:
      - fieldalignment  # Struct field alignment can be too strict

  gocyclo:
    min-complexity: 15  # Allow moderate complexity

  gocognit:
    min-complexity: 20  # Allow moderate cognitive complexity

  funlen:
    lines: 100
    statements: 50

  lll:
    line-length: 120
    tab-width: 4

  gosec:
    excludes:
      - G104  # Audit errors not checked (covered by errcheck)
      - G304  # File path from variable (intentional for CLI)

  goconst:
    min-len: 3
    min-occurrences: 3

issues:
  exclude-use-default: false
  max-issues-per-linter: 0
  max-same-issues: 0

  exclude-rules:
    # Exclude some linters from running on tests
    - path: _test\.go
      linters:
        - gocyclo
        - gocognit
        - funlen
        - gosec
        - goconst
        - lll
        - govet  # Allow shadow in tests

    # Exclude some staticcheck checks
    - linters:
        - staticcheck
      text: "SA1019:"  # Deprecated functions (may be needed for compatibility)

    # Allow long lines in generated code
    - path: "internal/templates/templates.go"
      linters:
        - lll

    # Allow globals in main.go (Cobra commands)
    - path: main\.go
      text: "global variable"

    # Allow higher complexity in alarm/calendar parsers (complex parsing logic)
    - path: "internal/calendar/alarms_parser.go"
      linters:
        - gocognit
        - gocyclo
        - funlen
        - lll
        - goconst
    - path: "internal/calendar/calendar.go"
      linters:
        - gocognit
        - gocyclo
        - godot
        - goconst
        - unconvert

    # Allow flexibility in other internal packages
    - path: "internal/i18n/"
      linters:
        - godot
    - path: "internal/config/"
      linters:
        - gosec  # Directory permissions 0755 is intentional

  # Fix found issues automatically (when possible)
  fix: false

output:
  sort-results: true
  print-issued-lines: true
  print-linter-name: true
